<!DOCTYPE html>
<html lang="zh-Hant-TW">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Demo System</title>

    <!-- Bootstrap & jQuery -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.css">
    <script src="//code.jquery.com/jquery-1.11.3.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.js" charset="utf-8"></script>

    <style>
      html, body { width: 100%; min-height: 100%; }
      .container-fluid, .row, .row>div, #input-form { height: 100%; }
      #input-form { position: relative; width: 100%; }
      #input-preview { width: 100%; }
      #input-preview img { width: 100%; max-width: 100%; max-height: 100%; }
      #input-confirm { padding-top: 5%; }
      #input-file [type=file] { display: none; }
      #food-candidate .btn { text-align: left;}
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-4">
          <form id="input-form" action="upload.php" method="post" enctype="multipart/form-data">
            <!-- Preview area -->
            <label id="input-preview" class="thumbnail text-center text-danger" for="hidden-input-file">
              <img class="img-responsive" src="image/default.png" alt="Invalid photo">
            </label>

            <!-- File as image input -->
            <label id="input-file" class="btn btn-default btn-lg btn-block">
              <span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span>
              <span>&nbsp; Upload from local</span>
              <input id="hidden-input-file" type="file" name="file" accept="image/*" />
            </label>
  
            <!-- URL as image input --> 
            <!--
            <div id="input-url" class="input-group input-group-lg">
              <span class="input-group-addon">or via URL</span>
              <input class="form-control" type="text" name="url" placeholder="Enter image URL"/>
              <span class="input-group-btn">
                <button class="btn btn-success btn-preview" type="button">Preview!</button>
              </span>
            </div>
            -->

            <!-- Button of submit or reset -->
            <div id="input-confirm" class="btn-group btn-group-lg btn-group-justified">
              <div class="btn-group btn-group-lg">
                <button class="btn btn-primary" type="submit" name="submit">
                  <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                  <span>Submit</span>
                </button>
              </div>
              <div class="btn-group btn-group-lg">
                <button class="btn btn-danger" type="reset">
                  <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                  <span>Reset</span>
                </button>
              </div>
            </div>
          </form>
        </div>
        <div id="food-candidate" class="col-sm-4">
            <h3>Food Candidate:</h3>
            <div class="btn-group-vertical"></div>
        </div>
        <div id="recommend" class="col-sm-4">
            <h3>Recommend Food:</h3>
            <div class="btn-group-vertical"></div>
        </div>
      </div>
    </div>

    <script>
        $(".btn-preview").click(function(){
            url = $("#input-url [type=text]").val();
            $("#input-preview img").attr('src', url);
            $("#hidden-input-file").val("");
        });

        $("#hidden-input-file").change(function(){
            $("#food-candidate .btn-group-vertical").html("");
            if(this.files && this.files[0]){
                var reader = new FileReader();
                reader.onload = function(e){
                    $("#input-preview img").attr('src', e.target.result);
                    $("#input-url").val("");
                }
                reader.readAsDataURL(this.files[0]);
            }
        });

        $("#input-confirm [type=reset]").click(function(){
            $("#input-preview img").attr('src', "image/default.png");
            $("#food-candidate .btn-group-vertical").html("");
        });

        $("#input-form").submit(function(e){
            e.preventDefault();
            var formData = new FormData($("#input-form")[0]);
            var promise = $.ajax({
                'url': "upload.php", 
                'type': 'POST', 
                'data': formData, 
                'success': function(data, textStatus, jqxhr){
                    var ret = JSON.parse(data);
                    outputCandidate(ret);
                }, 
                'cache': false, 
                'contentType': false, 
                'processData': false
            });
        });

        function outputCandidate(ret){
            $("#food-candidate .btn-group-vertical").html("");
            for(var idx = 0; idx < ret.length; idx++){
                rank = "rank" + (idx + 1);
                $("#food-candidate .btn-group-vertical").append(
                    '<button class="btn btn-lg btn-primary">'
                    + ret[idx]['name']
                    + ' <span class="badge">'
                    + ret[idx]['score']
                    + '%</span></button><br>'
                );
            }
        }
    </script>
  </body>
</html>
